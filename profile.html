<!DOCTYPE html>
<html lang="de">
<head>
    <title>Profilseite</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        form {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
            color: #333;
        }

        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        input:focus {
            border-color: #007BFF;
            outline: none;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background-color: #218838;
        }

        .error-message {
            color: red;
            text-align: center;
            margin-top: 10px;
        }
    </style>
<body>
    
    <form id="profile-form">
        <label for="name">Name:</label>
<input type="text" id="name" required><br>

<label for="vorname">Vorname:</label>
<input type="text" id="vorname" required><br>

<label for="straße">Straße:</label>
<input type="text" id="straße" required><br>

<label for="stadt">Stadt:</label>
<input type="text" id="stadt" required><br>

<label for="plz">PLZ:</label>
<input type="text" id="plz" required><br>

        
        <button type="submit">Speichern</button>
        <p id="profile-error" class="error-message"></p>
    </form>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        const supabaseUrl = 'https://vaugbzzhenbkmcuuoeai.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhdWdienpoZW5ia21jdXVvZWFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjg5MTgwODcsImV4cCI6MjA0NDQ5NDA4N30.BAKeLpt5GTm4eu9yQYCoNHL3pDVjk3q5aibIP5bkVIE';
        const supabase = createClient(supabaseUrl, supabaseKey);

        // Get the logged-in user's email or ID (replace 'user_email' with your actual logic)
        const userEmail = localStorage.getItem('userEmail'); // Assuming you store the user email after login
        
        async function loadProfileData() {
            const { data, error } = await supabase
                .from('profile')
                .select('*')
                .eq('Email', userEmail) // Assuming 'Email' is a column in your profile table
                .single();

            if (data) {
                // Populate form with the fetched data
                document.getElementById('name').value = data.Name || '';
                document.getElementById('vorname').value = data.Vorname || '';
                document.getElementById('straße').value = data.Straße || '';
                document.getElementById('stadt').value = data.Stadt || '';
                document.getElementById('plz').value = data.PLZ || '';
            } else if (error) {
                console.error("Fehler beim Laden des Profils:", error.message);
            }
        }

        document.getElementById('profile-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const name = document.getElementById('name').value;
            const vorname = document.getElementById('vorname').value;
            const straße = document.getElementById('straße').value;
            const stadt = document.getElementById('stadt').value;
            const plz = document.getElementById('plz').value;
            
            try {
                const { data, error } = await supabase
                    .from('profile')
                    .upsert([{ Name: name, Vorname: vorname, Straße: straße, Stadt: stadt, PLZ: plz, Email: userEmail }]);

                if (error) {
                    document.getElementById('profile-error').textContent = `Fehler: ${error.message}`;
                } else {
                    alert('Profil gespeichert!');
                }
            } catch (err) {
                document.getElementById('profile-error').textContent = `Fehler: ${err.message}`;
            }
        });

        // Load the profile data when the page loads
        loadProfileData();
    </script>
</body>
</html>
