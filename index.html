<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Product List</title>
    <style>
        /* Basic styling for products */
        .product-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            margin: 20px;
        }

        .product {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 10px;
            text-align: center;
            width: 200px;
            border-radius: 8px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Supabase Product List</h1>

    <!-- Product List Container -->
    <section id="product-list" class="product-list"></section>

    <!-- Supabase SDK and Scripts -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        // Supabase Initialization
        const supabaseUrl = 'https://vaugbzzhenbkmcuuoeai.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhdWdienpoZW5ia21jdXVvZWFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjg5MTgwODcsImV4cCI6MjA0NDQ5NDA4N30.BAKeLpt5GTm4eu9yQYCoNHL3pDVjk3q5aibIP5bkVIE'; // Replace with your Supabase key
        const supabase = createClient(supabaseUrl, supabaseKey);

        // Wait for the DOM to load
        document.addEventListener('DOMContentLoaded', async function () {
            const loggedIn = localStorage.getItem('loggedIn');  // Check if the user is logged in
            const productList = document.getElementById('product-list');

            // Fetch products from Supabase
            const { data: products, error } = await supabase
                .from('products') // Use your table name
                .select('*');

            if (error) {
                console.error('Error fetching products:', error.message);
                return;
            }

            // Dynamically add products to the HTML
            products.forEach(product => {
                const productHtml = `
                    <div class="product">
                        <img src="${product.image_url}" alt="${product.name}" style="width:100%; height:150px; object-fit:cover;">
                        <h2>${product.name}</h2>
                        <p class="price ${loggedIn !== 'true' ? 'hidden' : ''}">${product.price} €</p>
                        <input type="number" id="quantity-${product.id}" class="quantity ${loggedIn !== 'true' ? 'hidden' : ''}" min="1" value="1">
                        <button class="btn ${loggedIn !== 'true' ? 'hidden' : ''}" onclick="addToCart('${product.name}', 'quantity-${product.id}', ${product.price})">Add to Cart</button>
                    </div>
                `;
                productList.innerHTML += productHtml;
            });

            // Dummy cart function to handle the Add to Cart button
            window.addToCart = function(productName, quantityId, price) {
                const quantity = document.getElementById(quantityId).value;
                alert(`${quantity} x ${productName} added to cart at ${price} € each.`);
            };
        });
    </script>
</body>
</html>
